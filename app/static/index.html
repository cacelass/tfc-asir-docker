<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>TFC Alejandro</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h1 id="login-title">Login simple</h1>
    <form id="login-form">
        <input type="text" id="username" placeholder="Usuario" required>
        <input type="password" id="password" placeholder="Contraseña" required>
        <button type="submit">Entrar</button>
    </form>
    <div id="hola-section" style="display:none;"></div>
    <div id="adios-section" style="display:none;"></div>
    <script>
        let usuario = "";

        const loginTitle = document.getElementById('login-title');
        const loginForm = document.getElementById('login-form');
        const holaSection = document.getElementById('hola-section');
        const adiosSection = document.getElementById('adios-section');

        // Mostrar login y título
        function mostrarLogin() {
            loginForm.reset();
            loginTitle.style.display = 'block';
            loginForm.style.display = 'block';
            holaSection.style.display = 'none';
            adiosSection.style.display = 'none';
            usuario = "";
        }

        // Ocultar login y título
        function ocultarLogin() {
            loginTitle.style.display = 'none';
            loginForm.style.display = 'none';
        }

        // Mostrar la pantalla principal (hola)
        function mostrarHola() {
            holaSection.style.display = 'block';
            adiosSection.style.display = 'none';
            fetch('/holamundo', { headers: { 'autenticado': 'si' } })
                .then(res => res.text())
                .then(msg => {
                    holaSection.innerHTML = `
                        <h2>Hola mundo</h2>
                        <p>Bienvenido, <span id="usuario-logeado"></span>!</p>
                        <p>${msg}</p>
                        <button id="ir-adios">Ir a Adiós mundo</button>
                    `;
                    document.getElementById('usuario-logeado').textContent = usuario;
                    document.getElementById('ir-adios').onclick = mostrarAdios;
                });
        }

        function mostrarAdios() {
            holaSection.style.display = 'none';
            adiosSection.style.display = 'block';
            fetch('/adiosmundo', { headers: { 'autenticado': 'si' } })
                .then(res => res.text())
                .then(adiosMsg => {
                    adiosSection.innerHTML = `
                        <h2>¿Seguro que quiere salir, <span id="nombre-usuario"></span>?</h2>
                        <button id="logout-btn">Desloguearse</button>
                    `;
                    document.getElementById('nombre-usuario').textContent = usuario;
                    document.getElementById('logout-btn').onclick = mostrarLogin;
                });
        }

        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            usuario = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            fetch('/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: usuario, password: pass })
            })
            .then(res => res.json())
            .then(data => {
                if (data.autenticado === 'si') {
                    ocultarLogin();
                    mostrarHola();
                } else {
                    alert('Usuario o contraseña incorrectos');
                }
            });
        });

        // Por si recargas y hay que mostrar login por defecto
        mostrarLogin();
    </script>
</body>
</html>
