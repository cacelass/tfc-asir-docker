<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>TFC Alejandro</title>
    <style>
        body { font-family: sans-serif; }
        #contenido, #hola-section, #adios-section { display: none; }
    </style>
</head>
<body>
    <h1>Login simple</h1>
    <form id="login-form">
        <input type="text" id="username" placeholder="Usuario" required>
        <input type="password" id="password" placeholder="Contraseña" required>
        <button type="submit">Entrar</button>
    </form>
    <div id="contenido">
        <p>Bienvenido, <span id="usuario-logeado"></span>!</p>
        <button id="hola-btn">Hola mundo</button>
    </div>
    <div id="hola-section"></div>
    <div id="adios-section"></div>
    <script>
        let usuario = "";

        const loginForm = document.getElementById('login-form');
        const contenido = document.getElementById('contenido');
        const usuarioLogeado = document.getElementById('usuario-logeado');
        const holaSection = document.getElementById('hola-section');
        const adiosSection = document.getElementById('adios-section');

        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            usuario = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            fetch('/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: usuario, password: pass })
            })
            .then(res => res.json())
            .then(data => {
                if (data.autenticado === 'si') {
                    loginForm.style.display = 'none';
                    contenido.style.display = 'block';
                    usuarioLogeado.textContent = usuario;
                } else {
                    alert('Usuario o contraseña incorrectos');
                }
            });
        });

        document.getElementById('hola-btn').addEventListener('click', function() {
            // Oculta menú, muestra la sección hola
            contenido.style.display = 'none';
            adiosSection.style.display = 'none';
            holaSection.style.display = 'block';
            fetch('/holamundo', { headers: { 'autenticado': 'si' } })
                .then(res => res.text())
                .then(msg => {
                    holaSection.innerHTML = `
                        <h2>Hola mundo</h2>
                        <p>${msg}</p>
                        <button id="ir-adios">Ir a Adiós mundo</button>
                    `;
                    document.getElementById('ir-adios').onclick = () => {
                        holaSection.style.display = 'none';
                        adiosSection.style.display = 'block';
                        // Llama a /adiosmundo y muestra la pregunta
                        fetch('/adiosmundo', { headers: { 'autenticado': 'si' } })
                            .then(res => res.text())
                            .then(adiosMsg => {
                                adiosSection.innerHTML = `
                                    <h2>¿Seguro que quiere salir, <span id="nombre-usuario"></span>?</h2>
                                    <p>${adiosMsg}</p>
                                    <button id="volver-menu">No, volver</button>
                                `;
                                document.getElementById('nombre-usuario').textContent = usuario;
                                document.getElementById('volver-menu').onclick = () => {
                                    adiosSection.style.display = 'none';
                                    contenido.style.display = 'block';
                                }
                            });
                    };
                });
        });
    </script>
</body>
</html>
